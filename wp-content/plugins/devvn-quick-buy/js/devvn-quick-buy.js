!function(a){a(document).ready(function(){var e=a(".summary.entry-summary > .cart"),n=a(".devvn_prod_variable .cart");a(".devvn_prod_variable").length>0&&0==a(".devvn_prod_variable .quantity.buttons_added .screen-reader-text").length&&a(".devvn_prod_variable .quantity.buttons_added").append('<label class="screen-reader-text">Số lượng</label>'),a(".devvn_buy_now").on("click",function(){a(".devvn-popup-quickbuy").bPopup({speed:450,transition:"slideDown",zIndex:9999999,closeClass:"devvn-popup-close",onOpen:function(){a("select, input, textarea",e).each(function(){var e=a(this).attr("name"),t=a(this).val();a('[name="'+e+'"]',n).val(t)}),n.trigger("check_variations"),u()},onClose:function(){a("select, input, textarea",n).each(function(){var n=a(this).attr("name"),t=a(this).val();a('[name="'+n+'"]',e).val(t)}),e.trigger("check_variations")}})}),a.validator.addMethod("vietnamphone",function(a,e){return/^0+(\d{9,10})$/.test(a)},"Please enter a valid phone number"),a.validator.addMethod("customemail",function(a,e){return""==a||/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a)},"Định dạng email không đúng.");var t=a(".devvn_cusstom_info");t.validate({rules:{"customer-name":{required:!0,maxlength:100},"customer-phone":{required:{depends:function(){return a(this).val(a.trim(a(this).val())),!0}},vietnamphone:!0},"customer-quan":{required:function(e){return 1==a("#require_district").val()}},"customer-xa":{required:function(e){return 1==a("#require_village").val()}},"customer-address":{required:function(e){return 1==a("#require_address").val()}},"customer-email":{required:function(e){return 1==a(e).data("required")},customemail:!0}},messages:{"customer-name":"Họ tên là bắt buộc","customer-phone":"Số điện thoại là bắt buộc","customer-email":"Địa chỉ Email là bắt buộc","customer-quan":"Hãy chọn quận/huyện","customer-xa":"Hãy chọn xã/phường/thị trấn","customer-address":"Hãy nhập địa chỉ cụ thể như số nhà hoặc xóm."},errorLabelContainer:a(".devvn_quickbuy_mess")});var i=!1;a(".devvn-order-btn").on("click",function(){var e=a('.devvn_prod_variable .cart input[name="variation_id"]').val();if("string"==typeof e&&"0"!=e&&""!=e||void 0===e)if(a(".devvn_prod_variable .out-of-stock").length>0)alert(devvn_quickbuy_array.out_of_stock_mess);else{if(!t.valid())return;var n=a("#prod_nonce").val(),r=a("#prod_id").val(),o=a("#devvn_cusstom_info").serialize(),d=a(".devvn_prod_variable .cart").serialize();i||a.ajax({type:"post",dataType:"json",url:devvn_quickbuy_array.ajaxurl,data:{action:"devvn_quickbuy",prod_id:r,customer_info:o,product_info:d,nonce:n},context:this,beforeSend:function(){i=!0,a(".devvn-order-btn").addClass("loading")},success:function(e){e.success?a(".devvn-popup-content-right").html(e.data.content):alert(devvn_quickbuy_array.popup_error),i=!1,a(".devvn-order-btn").removeClass("loading")},error:function(e,n,t){alert(devvn_quickbuy_array.popup_error),i=!1,a(".devvn-order-btn").removeClass("loading")}})}else alert(wc_add_to_cart_variation_params.i18n_make_a_selection_text);return!1});var r=a("#enable_ship").val();if(a("#devvn_city").length>0){var o=!1,d=a("#prod_nonce").val(),c=0;a('button.single_add_to_cart_button[name="add-to-cart"]').length>0&&(c=parseInt(a('button.single_add_to_cart_button[name="add-to-cart"]').val())),a("#devvn_city").on("change",function(e){var n=e.val;if(n||(n=a("#devvn_city option:selected").val()),n&&!o){var t=a(".devvn_prod_variable .cart").serialize();a.ajax({type:"post",dataType:"json",url:devvn_quickbuy_array.ajaxurl,data:{action:"quickbuy_load_diagioihanhchinh",matp:n,getvalue:1,product_info:t,nonce:d,prod_id:c},context:this,beforeSend:function(){a(".popup-customer-info").addClass("popup_loading"),o=!0},success:function(e){if(a("#devvn_district").html(""),a("#devvn_ward").html('<option value="">Xã/phường</option>'),e.success){var n=e.data.list_district,t=new Option("Quận/huyện","");a("#devvn_district").append(t),a.each(n,function(e,n){var t=new Option(n.name,n.maqh);a("#devvn_district").append(t)}),r&&e.data.shipping&&a(".popup_quickbuy_shipping_calc").html(e.data.shipping)}o=!1,a(".popup-customer-info").removeClass("popup_loading"),u()}})}}),a("#devvn_district").length>0&&a("#devvn_district").on("change",function(e){var n=e.val;n||(n=a("#devvn_district option:selected").val());var t=a("#devvn_city option:selected").val();if(n&&!o){var i=a(".devvn_prod_variable .cart").serialize();a.ajax({type:"post",dataType:"json",url:devvn_quickbuy_array.ajaxurl,data:{action:"quickbuy_load_diagioihanhchinh",matp:t,maqh:n,getvalue:2,product_info:i,nonce:d,prod_id:c},context:this,beforeSend:function(){a(".popup-customer-info").addClass("popup_loading"),o=!0},success:function(e){if(a("#devvn_ward").html(""),e.success){var n=e.data.list_district,t=new Option("Xã/phường","");a("#devvn_ward").append(t),a.each(n,function(e,n){var t=new Option(n.name,n.xaid);a("#devvn_ward").append(t)}),r&&e.data.shipping&&a(".popup_quickbuy_shipping_calc").html(e.data.shipping)}o=!1,a(".popup-customer-info").removeClass("popup_loading"),u()}})}}),a(window).on("load",function(){a("#devvn_city").trigger("change")}),a(".devvn_prod_variable .cart").on("change",function(e){if(r){var n=a("#devvn_district option:selected").val(),t=a("#devvn_city option:selected").val(),i=a(".devvn_prod_variable .cart").serialize();a.ajax({type:"post",dataType:"json",url:devvn_quickbuy_array.ajaxurl,data:{action:"quickbuy_load_diagioihanhchinh",matp:t,maqh:n,getvalue:1,product_info:i,nonce:d,prod_id:c},context:this,beforeSend:function(){a(".popup-customer-info").addClass("popup_loading")},success:function(e){e.success&&r&&e.data.shipping&&a(".popup_quickbuy_shipping_calc").html(e.data.shipping),a(".popup-customer-info").removeClass("popup_loading"),u()}})}})}function u(){var e=a(".devvn_prod_variable .cart").data("product_variations"),n=a('.devvn_prod_variable input[name="quantity"]').val(),t=a('.devvn_prod_variable input[name="variation_id"]').val(),i=total=ship=0;r&&a(".popup_quickbuy_shipping_calc").length>0&&a('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]').length>0&&(ship=parseInt(a('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]:checked').data("cost")),ship||(ship=parseInt(a('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]').data("cost")))),e?a(e).each(function(a,e){e.variation_id==t&&e.variation_is_active&&e.variation_is_visible&&(i=e.display_price)}):i=a(".devvn_prod_variable").data("simpleprice"),total=i*n+ship,a(".popup_quickbuy_total_calc").html(function(a,e,n,t){e=devvn_quickbuy_array.num_decimals,n=devvn_quickbuy_array.price_decimal,a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var i=isFinite(+a)?+a:0,r=isFinite(+e)?Math.abs(e):0,o=void 0===t?",":t,d=void 0===n?".":n,c="";(c=(r?(u=i,p=r,v=Math.pow(10,p),""+Math.round(u*v)/v):""+Math.round(i)).split("."))[0].length>3&&(c[0]=c[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,o));var u,p,v;(c[1]||"").length<r&&(c[1]=c[1]||"",c[1]+=new Array(r-c[1].length+1).join("0"));return c.join(d)}(total.toFixed(0),0,"",".")+" "+devvn_quickbuy_array.currency_format)}u(),a("#devvn_cusstom_info, .devvn_prod_variable .cart").on("change",function(){u()})})}(jQuery);